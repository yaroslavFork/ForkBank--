<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForkBank 6.2 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í—Ö–æ–¥–∞</title>
    <style>
        body { background: #050a10; color: white; font-family: sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .app-container { width: 100%; max-width: 400px; margin-top: 10px; }
        .card { background: #101825; padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #1d2b41; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; background: #000; color: white; box-sizing: border-box; text-align: center; font-size: 16px; }
        button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 10px; background: #007bff; color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.1s; }
        button:active { transform: scale(0.98); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .balance-box { font-size: 42px; color: #00ffcc; margin: 5px 0; font-weight: bold; text-shadow: 0 0 15px rgba(0,255,204,0.3); }
        .status-vip { color: gold !important; font-weight: bold; }
        #admin-btn { position: fixed; bottom: 20px; right: 20px; background: gold; color: black; border-radius: 50%; width: 55px; height: 55px; font-size: 24px; font-weight: bold; display: none; z-index: 1000; border: none; cursor:pointer; }
        .hidden { display: none !important; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 350px; background: #1c2536; border: 2px solid gold; border-radius: 20px; z-index: 2000; padding: 20px; text-align: center; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1500; }
        .registry-box { background: #0a0f18; border: 1px solid #1d2b41; border-radius: 10px; margin: 20px 0 10px 0; padding: 10px; max-height: 100px; overflow-y: auto; text-align: left; }
        .registry-item { font-size: 11px; color: #aaa; padding: 3px 0; border-bottom: 1px solid #161d29; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="screen-login" class="card">
        <h1 style="color:#007bff;">ForkBank 6.2</h1>
        <p style="font-size:12px; color:#555;">–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="userpass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button id="login-btn">–í–û–ô–¢–ò / –°–û–ó–î–ê–¢–¨</button>
        <div id="login-status" style="color:red; font-size:12px; margin-top:5px;"></div>
    </div>

    <div id="screen-main" class="card hidden">
        <div id="user-info" style="color:#888; font-size: 14px; margin-bottom: 10px;"></div>
        <div class="balance-box"><span id="balance">0</span> D</div>
        
        <div class="clicker-section" style="margin-top:10px; background:#161d29; padding:15px; border-radius:15px; border:1px solid #007bff;">
            <button id="click-btn">–ö–õ–ò–ö (+10 D)</button>
            <div id="piggy-val" style="color:gold; font-size:28px; margin:5px; font-weight:bold;">0 D</div>
            <button id="withdraw-btn" style="background:#6f42c1;">–í–´–í–ï–°–¢–ò –í –ë–ê–ù–ö</button>
        </div>

        <input type="text" id="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
        <button id="apply-promo-btn" style="background:#6f42c1;">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</button>

        <div class="card" style="border: 1px solid gold; background: #161d29; margin-top: 10px; padding: 10px;">
            <h4 style="margin:5px; color:gold;">üé∞ –ö–ê–ó–ò–ù–û</h4>
            <div id="casino-anim" style="font-size:32px; margin:10px; font-weight:bold; color:gold;">1.0X</div>
            <input type="number" id="bet-amt" value="10">
            <button id="spin-btn" style="background:#ff4b2b;">–†–ò–°–ö–ù–£–¢–¨</button>
        </div>

        <div class="registry-box">
            <div id="ui-registry-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <button id="send-btn" style="background:#28a745;">üí∏ –ü–ï–†–ï–í–û–î</button>
        <button id="access-btn" style="opacity:0;">.</button>
        <button id="logout-btn" style="background:#222; font-size:12px;">–í–´–ô–¢–ò</button>
    </div>
</div>

<button id="admin-btn">–ü</button>

<div id="modal-admin" class="modal">
    <h2 style="color:gold;">–ü–†–ï–ó–ò–î–ï–ù–¢</h2>
    <button id="adm-list-btn" style="background:#17a2b8;">üìä –†–ï–ï–°–¢–†</button>
    <div id="admin-users-list" class="hidden" style="background:#000; border-radius:10px; padding:10px; max-height:150px; overflow-y:auto; text-align:left; font-size:10px; margin-bottom:10px;"></div>
    <button id="adm-promo-btn" style="background:#28a745;">üéÅ –ü–†–û–ú–û</button>
    <button id="adm-status-btn">üëë –°–¢–ê–¢–£–°</button>
    <button id="adm-edit">üí∞ –ë–ê–õ–ê–ù–°</button>
    <button id="adm-del-btn" style="background:#dc3545;">‚ùå –£–î–ê–õ–ò–¢–¨ –ê–ö–ö</button>
    <button onclick="closeModals()" style="background:#222; margin-top:10px;">–ó–ê–ö–†–´–¢–¨</button>
</div>
<div id="overlay" onclick="closeModals()"></div>

<script type="module">
    import { Client, Databases, ID, Query } from "https://cdn.jsdelivr.net/npm/appwrite@13.0.1/+esm";
    const client = new Client().setEndpoint('https://cloud.appwrite.io/v1').setProject('695f9aae003cc43e58d4');
    const databases = new Databases(client);
    const DB = '695f9bbc00302230a3eb', COL = 'users';

    const app = {
        user: null, allUsers: [], piggy: 0, lastActionTime: 0,

        async init() {
            window.closeModals = () => { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.getElementById('overlay').style.display='none'; };
            document.getElementById('login-btn').onclick = () => this.login();
            document.getElementById('click-btn').onclick = () => { if(this.user.status!=='banned'){this.piggy += 10; document.getElementById('piggy-val').innerText = this.piggy + " D";} };
            document.getElementById('withdraw-btn').onclick = () => this.withdrawPiggy();
            document.getElementById('apply-promo-btn').onclick = () => this.applyPromo();
            document.getElementById('spin-btn').onclick = () => this.playCasino();
            document.getElementById('send-btn').onclick = () => this.sendMoney();
            document.getElementById('access-btn').onclick = () => { if(prompt("–ö–û–î:")==="VYA_chsv") document.getElementById('admin-btn').style.display='block'; };
            document.getElementById('admin-btn').onclick = () => { document.getElementById('modal-admin').style.display='block'; document.getElementById('overlay').style.display='block'; };
            document.getElementById('adm-list-btn').onclick = () => { 
                const l = document.getElementById('admin-users-list'); 
                l.classList.toggle('hidden');
                l.innerHTML = this.allUsers.map(u => `<div>ID:${u.user_id} | ${u.name} | ${u.balance}D</div>`).join('');
            };
            document.getElementById('adm-promo-btn').onclick = () => this.createPromo();
            document.getElementById('adm-status-btn').onclick = () => this.adminSetStatus();
            document.getElementById('adm-edit').onclick = () => this.adminEdit();
            document.getElementById('adm-del-btn').onclick = () => this.adminDelete();
            document.getElementById('logout-btn').onclick = () => { localStorage.clear(); location.reload(); };

            const saved = localStorage.getItem('fork_session');
            if (saved) { const {n,p}=JSON.parse(saved); this.login(n,p); }
        },

        async login(nIn, pIn) {
            const n = (nIn || document.getElementById('username').value).trim();
            const p = (pIn || document.getElementById('userpass').value).trim();
            const statusBox = document.getElementById('login-status');
            if(!n || !p) return;

            document.getElementById('login-btn').disabled = true;
            statusBox.innerText = "–°–≤—è–∑—å —Å –±–∞–Ω–∫–æ–º...";

            try {
                const res = await databases.listDocuments(DB, COL, [Query.equal("name", n)]);
                if(res.documents.length > 0) {
                    const found = res.documents[0];
                    if(found.passworld === p) {
                        this.user = found;
                        this.startApp(n, p);
                    } else {
                        statusBox.innerText = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!";
                        document.getElementById('login-btn').disabled = false;
                    }
                } else {
                    // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
                    statusBox.innerText = "–°–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç...";
                    this.user = await databases.createDocument(DB, COL, ID.unique(), {
                        name: n, passworld: p, balance: 100, user_id: Math.floor(Math.random()*900)+100, status: 'user'
                    });
                    this.startApp(n, p);
                }
            } catch(e) {
                statusBox.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!";
                document.getElementById('login-btn').disabled = false;
            }
        },

        startApp(n, p) {
            localStorage.setItem('fork_session', JSON.stringify({n, p}));
            document.getElementById('screen-login').classList.add('hidden');
            document.getElementById('screen-main').classList.remove('hidden');
            this.refreshData();
            setInterval(() => this.refreshData(), 8000);
        },

        async sync(newBal) {
            this.user.balance = Math.floor(newBal);
            document.getElementById('balance').innerText = this.user.balance;
            await databases.updateDocument(DB, COL, this.user.$id, { balance: this.user.balance });
        },

        async refreshData() {
            try {
                const res = await databases.listDocuments(DB, COL);
                this.allUsers = res.documents.filter(u => u.status !== 'promo');
                document.getElementById('ui-registry-list').innerHTML = this.allUsers.map(u => `<div class="registry-item">${u.name} <span>ID: ${u.user_id}</span></div>`).join('');
                const fresh = this.allUsers.find(u => u.$id === this.user.$id);
                if(fresh) {
                    if(fresh.balance > this.user.balance) this.user.balance = fresh.balance;
                    this.user.status = fresh.status;
                    document.getElementById('balance').innerText = this.user.balance;
                    document.getElementById('user-info').innerHTML = `<span class="${this.user.status==='vip'?'status-vip':''}">${this.user.status==='vip'?'üëë ':''}${this.user.name}</span> (ID: ${this.user.user_id})`;
                }
            } catch(e) {}
        },

        async playCasino() {
            const bet = parseInt(document.getElementById('bet-amt').value);
            if(!bet || bet > this.user.balance) return;
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            const interval = setInterval(() => { document.getElementById('casino-anim').innerText = [0, 0.5, 1, 2, 5][Math.floor(Math.random()*5)] + "X"; }, 70);
            setTimeout(async () => {
                clearInterval(interval);
                const roll = Math.random();
                let res = roll < 0.3 ? 0 : roll < 0.5 ? 0.5 : roll < 0.8 ? 1 : roll < 0.95 ? 2 : 10;
                document.getElementById('casino-anim').innerText = res + "X";
                await this.sync((Number(this.user.balance) - bet) + Math.floor(bet * res));
                btn.disabled = false;
            }, 800);
        },

        async createPromo() {
            const c = prompt("–ö–æ–¥:"); const v = prompt("–°—É–º–º–∞:");
            if(c && v) await databases.createDocument(DB, COL, ID.unique(), { name: "PROMO_" + c, passworld: "SYS", balance: parseInt(v), user_id: 0, status: 'promo' });
        },

        async applyPromo() {
            const input = document.getElementById('promo-input').value.trim();
            const res = await databases.listDocuments(DB, COL, [Query.equal("name", "PROMO_" + input)]);
            if(res.documents.length > 0) {
                const doc = res.documents[0];
                await databases.deleteDocument(DB, COL, doc.$id);
                await this.sync(Number(this.user.balance) + doc.balance);
                alert("–£—Å–ø–µ—à–Ω–æ!");
                document.getElementById('promo-input').value = "";
            } else alert("–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω");
        },

        async withdrawPiggy() {
            if(!this.piggy) return;
            const amt = this.piggy; this.piggy = 0;
            document.getElementById('piggy-val').innerText = "0 D";
            await this.sync(Number(this.user.balance) + amt);
        },

        async adminSetStatus() {
            const id = prompt("ID:"); const t = this.allUsers.find(u => u.user_id == id);
            if(t) { const s = prompt("1-User, 2-VIP, 3-Ban"); await databases.updateDocument(DB, COL, t.$id, { status: s==='2'?'vip':s==='3'?'banned':'user' }); }
        },

        async adminEdit() {
            const id = prompt("ID:"); const v = parseInt(prompt("–°—É–º–º–∞ (+/-):"));
            const t = this.allUsers.find(u => u.user_id == id);
            if(t) await databases.updateDocument(DB, COL, t.$id, { balance: t.balance + v });
        },

        async adminDelete() {
            const id = prompt("ID –∞–∫–∫–∞—É–Ω—Ç–∞:");
            const t = this.allUsers.find(u => u.user_id == id);
            if(t && confirm("–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞?")) await databases.deleteDocument(DB, COL, t.$id);
        },

        async sendMoney() {
            const tid = prompt("ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è:"); const amt = parseInt(prompt("–°—É–º–º–∞:"));
            const target = this.allUsers.find(u => u.user_id == tid);
            if(!target || amt > this.user.balance || amt <= 0) return alert("–û—à–∏–±–∫–∞!");
            await databases.updateDocument(DB, COL, this.user.$id, { balance: this.user.balance - amt });
            await databases.updateDocument(DB, COL, target.$id, { balance: target.balance + amt });
            await this.sync(this.user.balance - amt);
            alert("–ì–æ—Ç–æ–≤–æ!");
        }
    };
    app.init();
</script>
</body>
</html>
